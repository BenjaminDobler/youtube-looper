<div class="timeline-container">
  <div class="timeline-header">
    <h3>Video Loops</h3>
    <div class="time-display">
      {{ currentTimeFormatted() }} / {{ durationFormatted() }}
    </div>
  </div>

  <div 
    class="timeline-track"
    (click)="onTimelineClick($event)"
    (mousemove)="onTimelineMouseMove($event)"
    (contextmenu)="onTimelineRightClick($event)"
  >
    <!-- Progress indicator -->
    <div class="progress-indicator" [style.left.%]="progressPercent()"></div>

    <!-- Existing loops -->
    @for (loop of loops; track loop.id) {
      <div 
        class="loop-segment"
        [class.active]="activeLoopId === loop.id"
        [ngStyle]="getLoopStyle(loop)"
        (click)="onLoopClick(loop, $event)"
        [title]="loop.name + ' (' + getLoopTimeLabel(loop) + ')'"
      >
        <span class="loop-name">{{ loop.name }}</span>
      </div>
    }

    <!-- Creation preview -->
    @if (isCreatingLoop()) {
      <div 
        class="loop-creation-preview"
        [ngStyle]="getCreationPreviewStyle()"
      ></div>
    }

    <!-- Time markers -->
    <div class="time-markers">
      <div class="marker" style="left: 0%">0:00</div>
      <div class="marker" style="left: 25%">{{ formatTime(duration * 0.25) }}</div>
      <div class="marker" style="left: 50%">{{ formatTime(duration * 0.5) }}</div>
      <div class="marker" style="left: 75%">{{ formatTime(duration * 0.75) }}</div>
      <div class="marker" style="left: 100%">{{ durationFormatted() }}</div>
    </div>
  </div>

  @if (loops.length === 0 && !isCreatingLoop()) {
    <div class="timeline-help">
      Click on the timeline to start creating a loop, then click again to finish
    </div>
  }

  @if (isCreatingLoop()) {
    <div class="timeline-help">
      Click again to finish creating the loop, or right-click to cancel
    </div>
  }
</div>
